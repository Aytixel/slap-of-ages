TARGET=main test_timer test_socket menu

LIB_DIR=lib/windows
INC_DIR=include/windows
LIB_TARGET=SDL2.dll SDL2_ttf.dll SDL2_image.dll

CC=gcc
CFLAGS=-g -Wall -I$(INC_DIR)
LFLAGS=-Wall -L$(LIB_DIR) -lmingw32 -lws2_32 -lSDL2main -lSDL2 -lSDL2_image -lSDL2_ttf -lpthread

SRC_DIR=src
OBJ_DIR=obj
BIN_DIR=bin
DLL_DIR=dll
TRGS:=$(TARGET:%=$(BIN_DIR)/%)

SOURCES:=$(wildcard $(SRC_DIR)/*.c)
OBJECTS:=$(SOURCES:$(SRC_DIR)/%.c=$(OBJ_DIR)/%.o)
MAINS:=$(TARGET:%=$(OBJ_DIR)/%.o)
OBJS:=$(filter-out $(MAINS),$(OBJECTS))

all: $(TRGS) copy_lib

$(TRGS): $(OBJECTS)
	@$(CC) $(subst $(BIN_DIR),$(OBJ_DIR),$@).o $(OBJS) $(LFLAGS) -o $@.exe
	@echo Linking $(subst $(BIN_DIR)/,,$@) complete!

$(OBJECTS): $(OBJ_DIR)/%.o : $(SRC_DIR)/%.c
	@$(CC) $(CFLAGS) -c $< -o $@
	@echo Compiled $< successfully!
	
.PHONY: copy_lib
copy_lib: $(LIB_TARGET)

$(LIB_TARGET):
	@copy $(DLL_DIR)\$@ $(BIN_DIR)\$@
	@echo Library $(DLL_DIR)/$@ -^> $(BIN_DIR)/$@ copied correctly!

.PHONY: clean
clean:
	@del $(subst /,\,$(OBJECTS))
	@echo Cleanup complete!

.PHONY: remove
remove: clean
	@del $(addsuffix .exe,$(subst /,\,$(TRGS)))
	@echo Executable removed!

.PHONY: docs
docs:
	@del /q "doc\html\"
	@del /q "doc\latex\"
	doxygen doc/doxyfile